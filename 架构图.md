# Figma MCP Server 架构设计

## 项目概述

本项目是一个基于 Model Context Protocol (MCP) 的 Figma 服务器，主要用于为 Cursor 提供 Figma 设计数据的访问能力。通过该服务器，Cursor 能够更准确地理解和实现 Figma 设计稿。

## 核心组件

### 1. 服务器核心 (src/server.ts)
- 提供 HTTP 服务器功能
- 处理 MCP 协议相关的请求
- 管理 SSE (Server-Sent Events) 连接
- 处理消息端点

### 2. Figma 服务 (src/services/figma.ts)
- 与 Figma API 交互
- 处理 Figma 文件、框架和组件的数据获取
- 提供数据转换和简化功能

### 3. 数据转换器 (src/transformers/)
- layout.ts: 处理布局相关的数据转换
- 将 Figma API 返回的复杂数据简化为更易于使用的格式

### 4. 工具类 (src/utils/)
- identity.ts: 处理身份验证相关功能

## 服务架构

```
[Cursor] <---> [MCP Server] <---> [Figma API]
    |             |                    |
    |             |                    |
    |        数据简化和转换            数据获取
    |             |                    |
    |         响应处理                 |
    |             |                    |
    +--------- 设计实现 <--------------+
```

## 数据流

1. 初始化流程：
   - 服务器启动（默认端口 3333）
   - 建立 SSE 端点和消息端点
   - 等待 Cursor 连接

2. 设计数据获取流程：
   - Cursor 发送 Figma 文件链接
   - 服务器通过 Figma API 获取设计数据
   - 数据经过简化和转换
   - 返回优化后的设计信息给 Cursor

## 技术栈

- Node.js (v20.17.0)
- TypeScript
- Express.js
- MCP SDK (@modelcontextprotocol/sdk)
- Figma REST API

## 开发模式

项目支持以下运行模式：
- 开发模式 (pnpm dev)
- HTTP 模式 (pnpm dev:http)
- CLI 模式 (NODE_ENV=cli)

## 安全性

- 使用环境变量管理 Figma API 访问令牌
- 仅需要 Figma API 的只读访问权限
- 数据传输过程中的简化处理可以减少敏感信息泄露

## 扩展性

系统的模块化设计允许：
1. 轻松添加新的数据转换器
2. 扩展支持更多的 Figma API 功能
3. 集成其他设计工具或服务
4. 自定义数据简化规则